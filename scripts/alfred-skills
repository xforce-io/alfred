#!/usr/bin/env python3
"""
Alfred Skills CLI - Convenient wrapper for skill-installer scripts

Usage:
    alfred-skills search <query>
    alfred-skills install <source> [--method METHOD]
    alfred-skills list [--json]
    alfred-skills update [skill_name] [--all]
    alfred-skills remove <skill_name> [--force] [--backup]
    alfred-skills help
"""

import os
import subprocess
import sys
from pathlib import Path


def get_script_dir() -> Path:
    """Get the skill-installer scripts directory"""
    # Find alfred root
    alfred_root = Path(__file__).parent.parent
    script_dir = alfred_root / "skills" / "skill-installer" / "scripts"

    if not script_dir.exists():
        print(f"Error: skill-installer not found at {script_dir}", file=sys.stderr)
        sys.exit(1)

    return script_dir


def run_script(script_name: str, args: list):
    """Run a skill-installer script"""
    script_dir = get_script_dir()
    script_path = script_dir / f"{script_name}.py"

    if not script_path.exists():
        print(f"Error: Script not found: {script_path}", file=sys.stderr)
        sys.exit(1)

    # Run the script with arguments
    cmd = ["python", str(script_path)] + args
    result = subprocess.run(cmd)
    sys.exit(result.returncode)


def print_help():
    """Print help message"""
    print("""Alfred Skills CLI - Manage Alfred skills

Usage:
    alfred-skills search <query>           Search for skills in the registry
    alfred-skills install <source>         Install a skill
        [--method METHOD]                  Installation method (registry/git/url/local)
    alfred-skills list [--json]            List installed skills
    alfred-skills update [skill_name]      Update a skill (or --all for all)
        [--all]                            Update all skills
    alfred-skills remove <skill_name>      Remove a skill
        [--force]                          Skip confirmation
        [--backup]                         Keep backup
        [--interactive]                    Interactive selection mode
    alfred-skills help                     Show this help

Examples:
    alfred-skills search calendar
    alfred-skills install calendar
    alfred-skills install https://github.com/user/skill --method git
    alfred-skills list
    alfred-skills update calendar
    alfred-skills update --all
    alfred-skills remove old-skill
    alfred-skills remove --interactive

For more information, see:
    skills/skill-installer/README.md
    docs/skill-installer-usage.md
""")


def main():
    if len(sys.argv) < 2:
        print_help()
        sys.exit(1)

    command = sys.argv[1]
    args = sys.argv[2:]

    if command in ["help", "--help", "-h"]:
        print_help()
        sys.exit(0)

    # Map commands to scripts
    command_map = {
        "search": "search",
        "install": "install",
        "list": "list",
        "update": "update",
        "remove": "remove",
    }

    if command not in command_map:
        print(f"Error: Unknown command '{command}'", file=sys.stderr)
        print("\nRun 'alfred-skills help' for usage information")
        sys.exit(1)

    script_name = command_map[command]
    run_script(script_name, args)


if __name__ == "__main__":
    main()
